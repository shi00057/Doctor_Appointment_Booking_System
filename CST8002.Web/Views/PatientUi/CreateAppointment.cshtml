@model CST8002.Web.Models.CreateAppointmentVm
@using Microsoft.AspNetCore.Mvc.Rendering
@{
    ViewData["Title"] = "Create Appointment";
}
<h2>Create Appointment</h2>

<form asp-action="CreateAppointment" method="post">
    <input type="hidden" asp-for="PatientId" />
    <div>
        <label>Doctor</label>
        <select asp-for="DoctorId" asp-items="Model.Doctors"></select>
        <span asp-validation-for="DoctorId"></span>
    </div>
    <div>
        <label>Date</label>
        <input asp-for="WorkDate" type="date" />
        <span asp-validation-for="WorkDate"></span>
    </div>
    <button type="submit">Load Available Slots</button>
</form>

@if (Model.Slots != null && Model.Slots.Count > 0)
{
    <h3>Available Slots</h3>
    <table>
        <thead>
            <tr>
                <th>Start</th>
                <th>End</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var s in Model.Slots)
            {
                <tr>
                    <td>@s.StartUtc.ToLocalTime()</td>
                    <td>@s.EndUtc.ToLocalTime()</td>
                    <td>
                        <form asp-action="Book" method="post">
                            <input type="hidden" name="patientId" value="@Model.PatientId" />
                            <input type="hidden" name="doctorId" value="@Model.DoctorId" />
                            <input type="hidden" name="startUtc" value="@s.StartUtc.ToString("o")" />
                            <input type="hidden" name="endUtc" value="@s.EndUtc.ToString("o")" />
                            <button type="submit">Book</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
<div>
    <a asp-action="MyAppointments" asp-route-patientId="@Model.PatientId">Back to My Appointments</a>
</div>
